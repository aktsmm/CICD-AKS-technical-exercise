# ğŸ§™â€â™‚ï¸ CICD-AKS-Technical Exercise

ã‚¯ãƒ©ã‚¦ãƒ‰ç’°å¢ƒã‚’æ§‹ç¯‰ã—ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ã‚’ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

## ğŸ“‹ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

### æ§‹æˆè¦ç´ 

- **AKS (Azure Kubernetes Service)** - ã‚³ãƒ³ãƒ†ãƒŠåŒ–ã•ã‚ŒãŸ BBS App
- **VM (MongoDB)** - Ubuntu 20.04 + MongoDB 4.4 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- **ACR (Azure Container Registry)** - Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ¬ã‚¸ã‚¹ãƒˆãƒª
- **Storage Account** - ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç”¨ Blob Storage
- **Azure Monitor** - ç›£æŸ»ãƒ­ã‚°åé›†

### æ„å›³çš„ãªè„†å¼±æ€§

1. **AKS**: Cluster Admin æ¨©é™ã®ä¸é©åˆ‡ãªä»˜ä¸
2. **VM**: SSH Port 22 ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆå…¬é–‹ã€å¤ã„ OS (Ubuntu 20.04)
3. **MongoDB**: èªè¨¼ãªã—ã€å…¨ IP ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã€å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ (4.4)
4. **Storage**: Public Blob Access æœ‰åŠ¹

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Azure Subscription                         â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Resource Group: <YOUR_RG_NAME>                  â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  VNet: vnet-wiz-dev (10.0.0.0/16)                    â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ Subnet: aks-subnet (10.0.1.0/24)    â”‚            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚                                       â”‚            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  AKS: aks-wiz-dev           â”‚    â”‚            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ Node Pool: 2 nodes      â”‚    â”‚            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  Standard_DS2_v2          â”‚    â”‚            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ Pod: guestbook-app (Ã—2) â”‚    â”‚            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â””â”€ Service: LoadBalancer   â”‚â—„â”€â”€â”€â”¼â”€â”€â”€ External IP
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ Subnet: mongo-subnet (10.0.2.0/24)  â”‚            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚                                       â”‚            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  VM: vm-mongo-dev           â”‚    â”‚            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ Ubuntu 20.04 LTS        â”‚    â”‚            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ MongoDB 4.4              â”‚â—„â”€â”€â”€â”¼â”€â”€â”€ AKS Pods
â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ Port 27017 (å…¨é–‹æ”¾)     â”‚    â”‚            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â””â”€ Port 22 (SSHå…¬é–‹) âš ï¸    â”‚â—„â”€â”€â”€â”¼â”€â”€â”€ Internet
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  ACR: acrwizdev[hash] (Premium/Basic)                â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ guestbook:latest                                 â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚             â–²                                                â”‚   â”‚
â”‚  â”‚             â”‚ AcrPull Role                                  â”‚   â”‚
â”‚  â”‚             â”‚                                                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  Storage: stwizdev[hash]                             â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ Container: backups                               â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ Public Blob Access: Enabled âš ï¸                   â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚             â–²                                                â”‚   â”‚
â”‚  â”‚             â”‚ Daily Backup (cron 2:00 AM JST)               â”‚   â”‚
â”‚  â”‚             â”‚                                                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  Log Analytics: log-dev                          â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ AKS Audit Logs                                   â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CI/CD ãƒ•ãƒ­ãƒ¼å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        GitHub Repository                            â”‚
â”‚                     (aktsmm/CICD-AKS-technical-exercise)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    git push (infra/** or app/**)
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         GitHub Actions                              â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Workflow 1: Deploy Infrastructure                        â”‚    â”‚
â”‚  â”‚  Trigger: infra/** changes                                â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  1. Checkov Scan (IaC Security)                     â”‚  â”‚    â”‚
â”‚  â”‚  â”‚     â””â”€ Check Bicep templates                        â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  2. Deploy Azure Resources (Bicep)                  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚     â”œâ”€ VNet + Subnets                               â”‚  â”‚    â”‚
â”‚  â”‚  â”‚     â”œâ”€ AKS Cluster                                  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚     â”œâ”€ ACR (with unique suffix)                     â”‚  â”‚    â”‚
â”‚  â”‚  â”‚     â”œâ”€ MongoDB VM + Managed Identity                â”‚  â”‚    â”‚
â”‚  â”‚  â”‚     â”œâ”€ Storage Account                              â”‚  â”‚    â”‚
â”‚  â”‚  â”‚     â”œâ”€ Log Analytics                                â”‚  â”‚    â”‚
â”‚  â”‚  â”‚     â”œâ”€ NSG (SSH + MongoDB public) âš ï¸                â”‚  â”‚    â”‚
â”‚  â”‚  â”‚     â””â”€ RBAC (Vulnerable ClusterAdmin) âš ï¸            â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  3. Wait for AKS Provisioning                       â”‚  â”‚    â”‚
â”‚  â”‚  â”‚     â””â”€ Poll every 30s (max 15min)                   â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  4. Save Outputs as Artifacts                       â”‚  â”‚    â”‚
â”‚  â”‚  â”‚     â”œâ”€ AKS_CLUSTER_NAME                             â”‚  â”‚    â”‚
â”‚  â”‚  â”‚     â”œâ”€ ACR_NAME                                     â”‚  â”‚    â”‚
â”‚  â”‚  â”‚     â””â”€ MONGO_VM_IP                                  â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                  â”‚                               â”‚
â”‚                   workflow_run trigger (on success)             â”‚
â”‚                                  â–¼                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Workflow 2: Build and Deploy Application                 â”‚  â”‚
â”‚  â”‚  Trigger: app/** changes OR infra success                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  1. Check Resource Group Existence                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â””â”€ Fail early if RG not found                   â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  2. Trivy Container Scan                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â””â”€ Scan for CVEs (CRITICAL/HIGH)                â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  3. Build & Push Docker Image                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â”œâ”€ Build: guestbook:${GITHUB_SHA}               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â”œâ”€ Push to ACR                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â””â”€ Tag as :latest                               â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  4. Deploy to AKS                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â”œâ”€ kubectl apply -f k8s/rbac-vulnerable.yaml âš ï¸ â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â”œâ”€ kubectl apply -f k8s/deployment.yaml         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â”œâ”€ kubectl apply -f k8s/service.yaml            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â””â”€ Update image: ACR/guestbook:${GITHUB_SHA}    â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Deployed Application                             â”‚
â”‚                                                                      â”‚
â”‚  Browser â†’ http://<EXTERNAL_IP> â†’ LoadBalancer                     â”‚
â”‚                                        â””â”€ AKS Pods (guestbook-app)  â”‚
â”‚                                               â””â”€ MongoDB VM          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Code Commit â†’ GitHub Actions                                   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  Checkov (IaC)    â”‚      â”‚  Trivy (Container)â”‚             â”‚
â”‚  â”‚  â”œâ”€ Bicep Scan    â”‚      â”‚  â”œâ”€ Image Scan    â”‚             â”‚
â”‚  â”‚  â””â”€ Misconfig     â”‚      â”‚  â””â”€ CVE Detection â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚           â”‚                           â”‚                         â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                       â–¼                                         â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚              â”‚  SARIF Upload   â”‚                                â”‚
â”‚              â”‚  to GitHub      â”‚                                â”‚
â”‚              â”‚  Security Tab   â”‚                                â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ï¿½ èªè¨¼ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€è¤‡æ•°ã®èªè¨¼ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’çµ„ã¿åˆã‚ã›ã¦ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚

### èªè¨¼ãƒ•ãƒ­ãƒ¼å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GitHub Actions Runner                             â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. Azure Login (Service Principal)                         â”‚   â”‚
â”‚  â”‚     â”œâ”€ Client ID (from AZURE_CREDENTIALS)                   â”‚   â”‚
â”‚  â”‚     â”œâ”€ Client Secret                                        â”‚   â”‚
â”‚  â”‚     â”œâ”€ Tenant ID                                            â”‚   â”‚
â”‚  â”‚     â””â”€ Subscription ID                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  2. Deploy Infrastructure (Bicep)                           â”‚   â”‚
â”‚  â”‚     â””â”€ Create Managed Identities                            â”‚   â”‚
â”‚  â”‚        â”œâ”€ AKS Kubelet Identity (AcrPullæ¨©é™)               â”‚   â”‚
â”‚  â”‚        â””â”€ VM System Assigned Identity (Storageæ¨©é™)        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  3. ACR Login & Push                                        â”‚   â”‚
â”‚  â”‚     â””â”€ az acr login (Service PrincipalçµŒç”±)                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  4. AKS kubectl Access                                      â”‚   â”‚
â”‚  â”‚     â””â”€ az aks get-credentials (Service PrincipalçµŒç”±)      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Runtime Authentication                            â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  AKS â†’ ACR (Image Pull)                                     â”‚   â”‚
â”‚  â”‚  â””â”€ AKS Kubelet Managed Identity + AcrPull Role            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  VM â†’ Storage Account (Backup Upload)                      â”‚   â”‚
â”‚  â”‚  â””â”€ VM System Assigned Managed Identity                    â”‚   â”‚
â”‚  â”‚     + Storage Blob Data Contributor Role                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  App â†’ MongoDB (Database Access)                            â”‚   â”‚
â”‚  â”‚  â””â”€ MONGO_URIç’°å¢ƒå¤‰æ•° (MongoDBæ¥ç¶šæ–‡å­—åˆ—)                  â”‚   â”‚
â”‚  â”‚     mongodb://<username>:<password>@<VM_IP>:27017/guestbook â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### èªè¨¼æ–¹å¼ã®è©³ç´°

#### 1. **Service Principal (GitHub Actions â†’ Azure)**

**ç”¨é€”**: CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‹ã‚‰ Azure ãƒªã‚½ãƒ¼ã‚¹ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»ç®¡ç†

**æ¨©é™**: Contributor (ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚¹ã‚³ãƒ¼ãƒ—)

**ä½œæˆæ–¹æ³•**:

```powershell
az ad sp create-for-rbac \
  --name "sp-wiz-exercise" \
  --role contributor \
  --scopes /subscriptions/<SUBSCRIPTION_ID> \
  --sdk-auth
```

**GitHub Secrets ã«è¨­å®š**:

- `AZURE_CREDENTIALS`: ç”Ÿæˆã•ã‚ŒãŸ JSON å…¨ä½“

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …**:

- âœ… æœ€å°æ¨©é™ã®åŸå‰‡: Contributor role ã«åˆ¶é™
- âœ… ã‚¹ã‚³ãƒ¼ãƒ—åˆ¶é™: ç‰¹å®šã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®ã¿
- âš ï¸ æ”¹å–„æ¡ˆ: ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚¹ã‚³ãƒ¼ãƒ—ã«åˆ¶é™å¯èƒ½

#### 2. **AKS Managed Identity (AKS â†’ ACR)**

**ç”¨é€”**: AKS ãŒ ACR ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ—ãƒ«

**èªè¨¼æ–¹å¼**: Kubelet Managed Identity + Azure RBAC

**è‡ªå‹•æ§‹æˆ**: Bicep ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«è‡ªå‹•è¨­å®š

```bicep
// infra/modules/aks-acr-role.bicep
resource roleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {
  name: guid(aksPrincipalId, acrId, 'AcrPull')
  scope: acr
  properties: {
    roleDefinitionId: subscriptionResourceId('Microsoft.Authorization/roleDefinitions',
                                            '7f951dda-4ed3-4680-a7ca-43fe172d538d') // AcrPull
    principalId: aksPrincipalId
    principalType: 'ServicePrincipal'
  }
}
```

**å‹•ä½œç¢ºèª**:

```powershell
# AKS Kubelet Identityã®Object IDå–å¾—
$KUBELET_ID = az aks show -g <RG_NAME> -n aks-wiz-dev \
  --query identityProfile.kubeletidentity.objectId -o tsv

# ACRã¸ã®ãƒ­ãƒ¼ãƒ«å‰²ã‚Šå½“ã¦ç¢ºèª
az role assignment list --assignee $KUBELET_ID --scope <ACR_RESOURCE_ID>
```

**åˆ©ç‚¹**:

- âœ… ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ—ãƒ«ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆä¸è¦
- âœ… èªè¨¼æƒ…å ±ã®ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ä¸è¦
- âœ… Azure RBAC çµ±åˆ

#### 3. **VM Managed Identity (VM â†’ Storage Account)**

**ç”¨é€”**: MongoDB VM ãŒãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ Storage Account ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

**èªè¨¼æ–¹å¼**: System Assigned Managed Identity + Azure RBAC

**è‡ªå‹•æ§‹æˆ**: Bicep ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«è‡ªå‹•è¨­å®š

```bicep
// infra/modules/vm-mongodb.bicep
resource vm 'Microsoft.Compute/virtualMachines@2023-03-01' = {
  name: vmName
  identity: {
    type: 'SystemAssigned'  // Managed Identityæœ‰åŠ¹åŒ–
  }
}

// infra/modules/vm-storage-role.bicep
resource roleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {
  scope: storageAccount
  properties: {
    roleDefinitionId: subscriptionResourceId('Microsoft.Authorization/roleDefinitions',
                                            'ba92f5b4-2d11-453d-a403-e96b0029c9fe') // Storage Blob Data Contributor
    principalId: vmPrincipalId
  }
}
```

**ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã®ä½¿ç”¨**:

```bash
# /usr/local/bin/mongodb-backup.sh (VMå†…)
az login --identity  # Managed Identityã§ãƒ­ã‚°ã‚¤ãƒ³
az storage blob upload \
  --account-name $STORAGE_ACCOUNT \
  --container-name backups \
  --name "backup-$(date +%Y%m%d-%H%M%S).gz" \
  --file /tmp/backup.gz \
  --auth-mode login  # Azure ADãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨
```

**åˆ©ç‚¹**:

- âœ… ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ä¸è¦
- âœ… è‡ªå‹•ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
- âœ… ç›£æŸ»ãƒ­ã‚°çµ±åˆ

#### 4. **MongoDB èªè¨¼ (App â†’ MongoDB)**

**ç”¨é€”**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ MongoDB ã¸ã®æ¥ç¶š

**èªè¨¼æ–¹å¼**: Username/Password èªè¨¼

**æ¥ç¶šæ–‡å­—åˆ—**:

```javascript
// Kubernetes Deploymentã§ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦æ³¨å…¥
const MONGO_URI =
  process.env.MONGO_URI ||
  "mongodb://<username>:<password>@<VM_IP>:27017/guestbook";
```

**Kubernetes Secret ç®¡ç†**:

```yaml
# app/k8s/deployment.yaml
env:
  - name: MONGO_URI
    value: "mongodb://adminuser:<password>@<MONGO_VM_IP>:27017/guestbook"
  - name: MONGO_PASSWORD
    valueFrom:
      secretKeyRef:
        name: mongodb-secret # æ¨å¥¨: Secretä½¿ç”¨
        key: password
```

**âš ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®æ³¨æ„**:

- ç¾åœ¨ã®å®Ÿè£…: ç’°å¢ƒå¤‰æ•°ã«å¹³æ–‡ä¿å­˜ (ãƒ‡ãƒ¢ç”¨)
- æœ¬ç•ªæ¨å¥¨: Kubernetes Secrets ã¾ãŸã¯ Azure Key Vault ä½¿ç”¨

#### 5. **kubectl Access (GitHub Actions â†’ AKS)**

**ç”¨é€”**: CI/CD ã‹ã‚‰ Kubernetes ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤

**èªè¨¼ãƒ•ãƒ­ãƒ¼**:

```yaml
# .github/workflows/app-deploy.yml
- name: Azure Login
  uses: azure/login@v1
  with:
    creds: ${{ secrets.AZURE_CREDENTIALS }} # Service Principal

- name: Set AKS Context
  run: |
    az aks get-credentials \
      --resource-group ${{ env.RESOURCE_GROUP }} \
      --name aks-wiz-dev \
      --overwrite-existing
    # ~/.kube/config ã«èªè¨¼æƒ…å ±ãŒä¿å­˜ã•ã‚Œã‚‹
```

**å‹•ä½œåŸç†**:

1. Service Principal ã§ Azure ã«ãƒ­ã‚°ã‚¤ãƒ³
2. AKS API çµŒç”±ã§ä¸€æ™‚çš„ãª kubeconfig å–å¾—
3. kubectl ãŒè‡ªå‹•çš„ã«ãƒˆãƒ¼ã‚¯ãƒ³ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥

### èªè¨¼ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

#### ACR Image Pull ã‚¨ãƒ©ãƒ¼

```powershell
# ã‚¨ãƒ©ãƒ¼: "Failed to pull image: unauthorized"

# ç¢ºèª1: Kubelet Identityã®AcrPullæ¨©é™
$KUBELET_ID = az aks show -g <RG_NAME> -n aks-wiz-dev \
  --query identityProfile.kubeletidentity.objectId -o tsv
az role assignment list --assignee $KUBELET_ID

# ç¢ºèª2: ACRãƒªã‚½ãƒ¼ã‚¹ID
$ACR_ID = az acr show -n <ACR_NAME> --query id -o tsv

# ä¿®æ­£: æ¨©é™ãŒä¸è¶³ã—ã¦ã„ã‚‹å ´åˆ
az role assignment create \
  --assignee $KUBELET_ID \
  --role AcrPull \
  --scope $ACR_ID
```

#### VM Backup Upload ã‚¨ãƒ©ãƒ¼

```powershell
# ã‚¨ãƒ©ãƒ¼: "AuthorizationPermissionMismatch"

# VM Managed Identityå–å¾—
$VM_PRINCIPAL_ID = az vm show -g <RG_NAME> -n vm-mongo-dev \
  --query identity.principalId -o tsv

# Storage Accountæ¨©é™ç¢ºèª
az role assignment list --assignee $VM_PRINCIPAL_ID

# ä¿®æ­£: Storage Blob Data Contributorè¿½åŠ 
az role assignment create \
  --assignee $VM_PRINCIPAL_ID \
  --role "Storage Blob Data Contributor" \
  --scope <STORAGE_ACCOUNT_RESOURCE_ID>
```

## ï¿½ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### å‰ææ¡ä»¶

- **Azure CLI** ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ ([ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¬ã‚¤ãƒ‰](https://docs.microsoft.com/ja-jp/cli/azure/install-azure-cli))
- **Azure ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³** (ç„¡æ–™è©¦ç”¨ç‰ˆå¯)
- **GitHub ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**
- **Git** ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿

> **Note**: ã“ã® README ã§ã¯ `<YOUR_RG_NAME>` ã‚’ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—åã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã¨ã—ã¦ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚
> å®Ÿéš›ã®ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—åã¯ `infra/main.bicep` ã® `targetScope` ã¨ `rg` ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚
> ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: `rg-cicd-aks` (ç’°å¢ƒã«ã‚ˆã£ã¦å¤‰æ›´å¯èƒ½)

### 1ï¸âƒ£ ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ•ã‚©ãƒ¼ã‚¯

ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’è‡ªåˆ†ã® GitHub ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ãƒ•ã‚©ãƒ¼ã‚¯ã—ã¾ã™ã€‚

### 2ï¸âƒ£ Azure èªè¨¼

```powershell
az login
az account set --subscription "<YOUR_SUBSCRIPTION_ID>"
```

### 3ï¸âƒ£ ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ä½œæˆ

```powershell
az ad sp create-for-rbac `
  --name "sp-wiz-exercise" `
  --role contributor `
  --scopes /subscriptions/<YOUR_SUBSCRIPTION_ID> `
  --sdk-auth > azure-credentials.json
```

ç”Ÿæˆã•ã‚ŒãŸ `azure-credentials.json` ã®å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚

### 4ï¸âƒ£ GitHub ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆè¨­å®š

ãƒ•ã‚©ãƒ¼ã‚¯ã—ãŸãƒªãƒã‚¸ãƒˆãƒªã§: **Settings** > **Secrets and variables** > **Actions** > **New repository secret**

| Secret å               | å€¤                                      |
| ----------------------- | --------------------------------------- |
| `AZURE_CREDENTIALS`     | azure-credentials.json ã®å†…å®¹å…¨ä½“       |
| `AZURE_SUBSCRIPTION_ID` | Azure ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ ID             |
| `MONGO_ADMIN_PASSWORD`  | MongoDB ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ (ä»»æ„ã®æ–‡å­—åˆ—) |

### 5ï¸âƒ£ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œ

**Actions** ã‚¿ãƒ– > **Deploy Infrastructure** > **Run workflow** ã‚’ã‚¯ãƒªãƒƒã‚¯

ã¾ãŸã¯ã€ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¦ push:

```powershell
git clone https://github.com/<YOUR_USERNAME>/CICD-AKS-technical-exercise.git
cd CICD-AKS-technical-exercise

# ä»»æ„ã®å¤‰æ›´ã‚’åŠ ãˆã‚‹
git add .
git commit -m "Trigger deployment"
git push
```

GitHub Actions ãŒè‡ªå‹•çš„ã«:

1. **ã‚¤ãƒ³ãƒ•ãƒ©ãƒ‡ãƒ—ãƒ­ã‚¤** (AKS, ACR, MongoDB VM, Storage ãªã©)
2. **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ—ãƒ­ã‚¤** (Docker build & push, kubectl apply)

ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ãƒ‡ãƒ—ãƒ­ã‚¤ã«ã¯ç´„**15-20 åˆ†**ã‹ã‹ã‚Šã¾ã™ã€‚

### 6ï¸âƒ£ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¸ã‚¢ã‚¯ã‚»ã‚¹

```powershell
# AKSèªè¨¼æƒ…å ±å–å¾—
az aks get-credentials --resource-group <YOUR_RG_NAME> --name aks-wiz-dev --overwrite-existing

# External IPå–å¾—
kubectl get svc guestbook-service -n default
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://<EXTERNAL-IP>` ã‚’é–‹ãã¾ã™ã€‚

## ğŸ“‚ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
wiz-technical-exercise/
â”œâ”€â”€ app/                          # Node.jsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ app.js                   # Express.jsã‚µãƒ¼ãƒãƒ¼
â”‚   â”œâ”€â”€ Dockerfile               # ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸å®šç¾©
â”‚   â”œâ”€â”€ package.json             # ä¾å­˜é–¢ä¿‚
â”‚   â”œâ”€â”€ wizexercise.txt          # ãƒ‡ãƒ¢ç”¨ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ views/                   # EJSãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”‚   â”‚   â””â”€â”€ index.ejs           # æ²ç¤ºæ¿UI
â”‚   â””â”€â”€ k8s/                     # Kubernetesãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ
â”‚       â”œâ”€â”€ deployment.yaml      # ã‚¢ãƒ—ãƒªãƒ‡ãƒ—ãƒ­ã‚¤
â”‚       â”œâ”€â”€ service.yaml         # LoadBalancer Service
â”‚       â”œâ”€â”€ ingress.yaml         # Ingress (App Gateway)
â”‚       â”œâ”€â”€ ingress-nginx.yaml   # Ingress (NGINXä»£æ›¿)
â”‚       â””â”€â”€ rbac-vulnerable.yaml # è„†å¼±ãªRBACè¨­å®š
â”œâ”€â”€ infra/                       # Infrastructure as Code (Bicep)
â”‚   â”œâ”€â”€ main.bicep              # ãƒ¡ã‚¤ãƒ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ parameters.json         # ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆæœªä½¿ç”¨ï¼‰
â”‚   â”œâ”€â”€ scripts/                # VMã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”‚   â””â”€â”€ install-mongodb.sh  # MongoDB 4.4ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
â”‚   â””â”€â”€ modules/                # Bicepãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚       â”œâ”€â”€ aks.bicep           # AKSã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼
â”‚       â”œâ”€â”€ acr.bicep           # Azure Container Registry
â”‚       â”œâ”€â”€ aks-acr-role.bicep  # AKS-ACRèªè¨¼è¨­å®š
â”‚       â”œâ”€â”€ vm-mongodb.bicep    # MongoDB VM
â”‚       â”œâ”€â”€ vm-role-assignment.bicep  # VM Managed Identity
â”‚       â”œâ”€â”€ vm-storage-role.bicep     # VMã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ¨©é™
â”‚       â”œâ”€â”€ storage.bicep       # Storage Account
â”‚       â”œâ”€â”€ networking.bicep    # VNet/Subnet
â”‚       â””â”€â”€ monitoring.bicep    # Log Analytics
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/              # GitHub Actions
â”‚       â”œâ”€â”€ infra-deploy.yml   # ã‚¤ãƒ³ãƒ•ãƒ©ãƒ‡ãƒ—ãƒ­ã‚¤
â”‚       â”œâ”€â”€ app-deploy.yml     # ã‚¢ãƒ—ãƒªãƒ‡ãƒ—ãƒ­ã‚¤
â”‚       â””â”€â”€ cleanup.yml        # ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å±¥æ­´ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
â”œâ”€â”€ pipelines/                  # Azure Pipelinesï¼ˆä»£æ›¿CI/CDï¼‰
â”‚   â”œâ”€â”€ azure-pipelines-infra.yml
â”‚   â””â”€â”€ azure-pipelines-app.yml
â”œâ”€â”€ docs/                       # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ ENVIRONMENT_INFO.md    # ç’°å¢ƒæƒ…å ±
â”‚   â”œâ”€â”€ AZURE_SETUP_INFO.md    # Azureã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †
â”‚   â””â”€â”€ MICROSOFT_DOCS_VALIDATION.md
â”œâ”€â”€ Docs_issue_point/          # ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å±¥æ­´
â”‚   â”œâ”€â”€ Phase02_ã‚¢ãƒ—ãƒªãƒ‡ãƒ—ãƒ­ã‚¤å•é¡Œã¨è§£æ±º_2025-10-29.md
â”‚   â”œâ”€â”€ Phase03_kubectlç’°å¢ƒè¨­å®š_2025-10-29.md
â”‚   â”œâ”€â”€ Phase04_MongoDBãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Ÿè£…_2025-10-29.md
â”‚   â”œâ”€â”€ Phase06_ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä¾å­˜é–¢ä¿‚å®Ÿè£…_2025-10-29.md
â”‚   â”œâ”€â”€ Phase07_AKS-ACRèªè¨¼ã‚¨ãƒ©ãƒ¼è§£æ±º_2025-10-29.md
â”‚   â”œâ”€â”€ Phase08_AKSãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°å¾…æ©Ÿå®Ÿè£…_2025-10-29.md
â”‚   â”œâ”€â”€ Phase09_MongoDB4.4ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¿®æ­£_2025-10-29.md
â”‚   â”œâ”€â”€ Phase10_ACRåå‰è¡çªè§£æ±º_2025-10-29.md
â”‚   â””â”€â”€ Phase11_å¤–éƒ¨ã‚¢ã‚¯ã‚»ã‚¹è¨­å®š_2025-10-30.md
â””â”€â”€ Docs_work_history/         # ä½œæ¥­å±¥æ­´

```

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¤œè¨¼

### è„†å¼±æ€§ç¢ºèª

```powershell
# ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—åã‚’è¨­å®š
$RG_NAME = "<YOUR_RG_NAME>"

# Storage Public Access
$STORAGE_NAME = (az storage account list --resource-group $RG_NAME --query "[0].name" -o tsv)
az storage account show `
  --name $STORAGE_NAME `
  --query allowBlobPublicAccess

# SSHå…¬é–‹ç¢ºèª
$NSG_NAME = "vm-mongo-dev-nsg"
az network nsg rule show `
  --resource-group $RG_NAME `
  --nsg-name $NSG_NAME `
  --name Allow-SSH-Internet

# MongoDBèªè¨¼ãªã—ç¢ºèª
$MONGO_IP = (az vm show -g $RG_NAME -n vm-mongo-dev --show-details --query publicIps -o tsv)
# èªè¨¼ãªã—ã§æ¥ç¶šå¯èƒ½ (è„†å¼±æ€§)
mongosh "mongodb://${MONGO_IP}:27017/guestbook"

# Kubernetes RBAC
kubectl get clusterrolebindings developer-cluster-admin -o yaml
```

## ğŸ“Š ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¢ã‚¯ã‚»ã‚¹

### LoadBalancer External IP ã®å–å¾—

```powershell
# AKSã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼èªè¨¼æƒ…å ±ã‚’å–å¾—
az aks get-credentials --resource-group <YOUR_RG_NAME> --name aks-wiz-dev --overwrite-existing

# External IPã‚’ç¢ºèª
kubectl get svc guestbook-service -n default
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹: `http://<EXTERNAL-IP>`

### wizexercise.txt ç¢ºèª

```powershell
# Podå†…ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª
$POD_NAME = (kubectl get pods -l app=guestbook -o jsonpath='{.items[0].metadata.name}')
kubectl exec $POD_NAME -- cat /app/wizexercise.txt
```

## ğŸ› ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### LoadBalancer External IP ãŒ pending ã®ã¾ã¾

```powershell
# ServiceçŠ¶æ…‹ç¢ºèª
kubectl get svc guestbook-service -n default

# AKS LoadBalancerè¨­å®šç¢ºèª
kubectl describe svc guestbook-service -n default

# é€šå¸¸2-3åˆ†ã§å‰²ã‚Šå½“ã¦å®Œäº†
```

### MongoDB ã«æ¥ç¶šã§ããªã„

```powershell
# VM IPã‚¢ãƒ‰ãƒ¬ã‚¹ç¢ºèª
$MONGO_IP = (az vm show `
  -g <YOUR_RG_NAME> `
  -n vm-mongo-dev `
  --show-details `
  --query publicIps -o tsv)

# NSGç¢ºèª (Port 27017ãŒé–‹ã„ã¦ã„ã‚‹ã‹)
az network nsg rule list `
  --resource-group <YOUR_RG_NAME> `
  --nsg-name vm-mongo-dev-nsg `
  --query "[?destinationPortRange=='27017']"

# Deploymentã®ç’°å¢ƒå¤‰æ•°ã‚’ç¢ºèª
kubectl get deployment guestbook-app -o yaml | grep MONGO_URI
```

### ACR èªè¨¼ã‚¨ãƒ©ãƒ¼

```powershell
# AKS Managed Identityã«AcrPullæ¨©é™ãŒã‚ã‚‹ã‹ç¢ºèª
$AKS_KUBELET_ID = (az aks show -g <YOUR_RG_NAME> -n aks-wiz-dev --query identityProfile.kubeletidentity.objectId -o tsv)
$ACR_ID = (az acr show -g <YOUR_RG_NAME> -n $(az acr list -g <YOUR_RG_NAME> --query "[0].name" -o tsv) --query id -o tsv)

az role assignment list --assignee $AKS_KUBELET_ID --scope $ACR_ID
```

## ğŸ§¹ ãƒªã‚½ãƒ¼ã‚¹å‰Šé™¤

```powershell
# ã™ã¹ã¦ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤
az group delete --name <YOUR_RG_NAME> --yes --no-wait

# ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«å‰Šé™¤
$SP_ID = (az ad sp list --display-name "sp-wiz-exercise" --query "[0].appId" -o tsv)
az ad sp delete --id $SP_ID
```

## ï¿½ é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [ç’°å¢ƒæƒ…å ±](docs/ENVIRONMENT_INFO.md) - ãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒã®è©³ç´°
- [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å±¥æ­´](Docs_issue_point/) - Phase 02-11 ã®å•é¡Œè§£æ±ºè¨˜éŒ²
- [Azure ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](docs/AZURE_SETUP_INFO.md) - Azure æ§‹æˆæ‰‹é †

## âš ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«é–¢ã™ã‚‹æ³¨æ„

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯**æ•™è‚²ç›®çš„**ã§æ„å›³çš„ã«è„†å¼±æ€§ã‚’å«ã‚“ã§ã„ã¾ã™:

- âœ… **ãƒ‡ãƒ¢ç’°å¢ƒå°‚ç”¨** - æœ¬ç•ªç’°å¢ƒã§ã¯ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„
- âœ… **å®šæœŸçš„ãªå‰Šé™¤** - ä½¿ç”¨å¾Œã¯å¿…ãšãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ã—ã¦ãã ã•ã„
- âœ… **ã‚³ã‚¹ãƒˆç®¡ç†** - AKS/VM ç¨¼åƒã§ã‚³ã‚¹ãƒˆãŒç™ºç”Ÿã—ã¾ã™

## ï¿½ğŸ“ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ MIT ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸‹ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚è©³ç´°ã¯ [LICENSE](LICENSE) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ğŸ¤ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

Issue ã‚„ Pull Request ã¯æ­“è¿ã—ã¾ã™ï¼

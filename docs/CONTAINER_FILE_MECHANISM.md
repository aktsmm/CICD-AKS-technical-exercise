# wizexercise.txt ã®ã‚³ãƒ³ãƒ†ãƒŠè»¢é€ãƒ¡ã‚«ãƒ‹ã‚ºãƒ 

**ä½œæˆæ—¥**: 2025 å¹´ 10 æœˆ 31 æ—¥  
**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: CICD-AKS-Technical Exercise

---

## ğŸ¯ æ¦‚è¦

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€`wizexercise.txt` ãŒã©ã®ã‚ˆã†ã«ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã‹ã‚‰ Kubernetes Pod ã®ã‚³ãƒ³ãƒ†ãƒŠå†…éƒ¨ã«å±Šãã®ã‹ã€ãã®å…¨ãƒ—ãƒ­ã‚»ã‚¹ã‚’è©³ç´°ã«è§£èª¬ã—ã¾ã™ã€‚

**é‡è¦ãªç™ºè¦‹**: ã“ã‚Œã¯ã€Œè»¢é€ã€ã§ã¯ãªãã€Œç„¼ãè¾¼ã¿ã€ã§ã™ã€‚

---

## ğŸ“Š å…¨ä½“ãƒ•ãƒ­ãƒ¼å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ (é–‹ç™ºè€…ã®PC)                                 â”‚
â”‚                                                                   â”‚
â”‚  ğŸ“ wiz-technical-exercise/app/                                  â”‚
â”‚     â”œâ”€â”€ app.js                                                   â”‚
â”‚     â”œâ”€â”€ package.json                                             â”‚
â”‚     â”œâ”€â”€ Dockerfile                 â† ğŸ“ ãƒ“ãƒ«ãƒ‰æ‰‹é †æ›¸            â”‚
â”‚     â””â”€â”€ wizexercise.txt            â† ğŸ“„ ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«            â”‚
â”‚                                                                   â”‚
â”‚  $ git add .                                                     â”‚
â”‚  $ git commit -m "Update wizexercise.txt"                       â”‚
â”‚  $ git push origin main           â† â¬†ï¸ GitHubã«ãƒ—ãƒƒã‚·ãƒ¥         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ GitHub Actions ãƒˆãƒªã‚¬ãƒ¼
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. GitHub Actions (CI/CD Runner)                                â”‚
â”‚                                                                   â”‚
â”‚  ğŸ¤– Workflow: app-deploy.yml                                     â”‚
â”‚                                                                   â”‚
â”‚  Step 1: Checkout Code                                           â”‚
â”‚  â”œâ”€> actions/checkout@v4                                         â”‚
â”‚  â”œâ”€> git clone ãƒªãƒã‚¸ãƒˆãƒªå…¨ä½“ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰                      â”‚
â”‚  â””â”€> app/wizexercise.txt ã‚‚å«ã¾ã‚Œã‚‹                             â”‚
â”‚                                                                   â”‚
â”‚  Step 2: Build Docker Image                                      â”‚
â”‚  â”œâ”€> cd app/                                                     â”‚
â”‚  â”œâ”€> docker build -t guestbook:${GITHUB_SHA} .                  â”‚
â”‚  â”‚                                                                â”‚
â”‚  â”‚   ğŸ³ Dockerãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹é–‹å§‹                                 â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   â”‚ Dockerfile ã®å®Ÿè¡Œ (ãƒ¬ã‚¤ãƒ¤ãƒ¼ã”ã¨ã«å‡¦ç†)        â”‚          â”‚
â”‚  â”‚   â”‚                                                â”‚          â”‚
â”‚  â”‚   â”‚ Step 1/7: FROM node:18-alpine                 â”‚          â”‚
â”‚  â”‚   â”‚   â””â”€> ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’Pull                    â”‚          â”‚
â”‚  â”‚   â”‚                                                â”‚          â”‚
â”‚  â”‚   â”‚ Step 2/7: WORKDIR /app                        â”‚          â”‚
â”‚  â”‚   â”‚   â””â”€> /app ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ                   â”‚          â”‚
â”‚  â”‚   â”‚                                                â”‚          â”‚
â”‚  â”‚   â”‚ Step 3/7: COPY wizexercise.txt /app/       â­ â”‚          â”‚
â”‚  â”‚   â”‚   â””â”€> ãƒ­ãƒ¼ã‚«ãƒ« â†’ ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ç„¼ãè¾¼ã¿   â”‚          â”‚
â”‚  â”‚   â”‚       ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ãŒã‚¤ãƒ¡ãƒ¼ã‚¸ã«æ°¸ç¶šåŒ–          â”‚          â”‚
â”‚  â”‚   â”‚                                                â”‚          â”‚
â”‚  â”‚   â”‚ Step 4/7: COPY package*.json ./               â”‚          â”‚
â”‚  â”‚   â”‚ Step 5/7: RUN npm install                     â”‚          â”‚
â”‚  â”‚   â”‚ Step 6/7: COPY . .                            â”‚          â”‚
â”‚  â”‚   â”‚ Step 7/7: CMD ["npm", "start"]                â”‚          â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚  â”‚                                                                â”‚
â”‚  â””â”€> ğŸ Dockerã‚¤ãƒ¡ãƒ¼ã‚¸å®Œæˆ                                       â”‚
â”‚      â””â”€> wizexercise.txt ãŒã‚¤ãƒ¡ãƒ¼ã‚¸ã«ç„¼ãè¾¼ã¾ã‚ŒãŸ               â”‚
â”‚          (ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä¸€éƒ¨ã¨ã—ã¦æ°¸ç¶šåŒ–)                    â”‚
â”‚                                                                   â”‚
â”‚  Step 3: Trivy Security Scan                                     â”‚
â”‚  â””â”€> ã‚¤ãƒ¡ãƒ¼ã‚¸ã®è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³                                    â”‚
â”‚                                                                   â”‚
â”‚  Step 4: Push to ACR                                             â”‚
â”‚  â””â”€> docker push <ACR_NAME>.azurecr.io/guestbook:${SHA}         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’Azure Container Registryã«ä¿å­˜
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. Azure Container Registry (ACR)                               â”‚
â”‚                                                                   â”‚
â”‚  ğŸ“¦ ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ä¿ç®¡åº«                                       â”‚
â”‚     Registry: <ACR_NAME>.azurecr.io                             â”‚
â”‚     Repository: guestbook                                        â”‚
â”‚     Tag: ${GITHUB_SHA}                                           â”‚
â”‚                                                                   â”‚
â”‚  ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹é€ :                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Layer 1: node:18-alpine (200MB)                        â”‚    â”‚
â”‚  â”‚   â””â”€> Node.js 18 ãƒ©ãƒ³ã‚¿ã‚¤ãƒ                             â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ Layer 2: WORKDIR /app (0.1KB)                          â”‚    â”‚
â”‚  â”‚   â””â”€> ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ                                 â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ Layer 3: wizexercise.txt (0.8KB)                    â­ â”‚    â”‚
â”‚  â”‚   â””â”€> ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ãŒç„¼ãè¾¼ã¾ã‚Œã¦ã„ã‚‹                   â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ Layer 4: package.json (0.5KB)                          â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ Layer 5: npm dependencies (50MB)                       â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ Layer 6: Application code (2MB)                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                   â”‚
â”‚  ğŸ”’ ç‰¹å¾´:                                                        â”‚
â”‚  - ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ä¸å¤‰ (Immutable)                                   â”‚
â”‚  - ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã§åŠ¹ç‡çš„                                    â”‚
â”‚  - SHA256ãƒãƒƒã‚·ãƒ¥ã§æ•´åˆæ€§ä¿è¨¼                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Kubernetes ãŒ Pull
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. AKS Cluster (Kubernetes)                                     â”‚
â”‚                                                                   â”‚
â”‚  ğŸ“‹ Deployment é©ç”¨                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ apiVersion: apps/v1                                     â”‚    â”‚
â”‚  â”‚ kind: Deployment                                        â”‚    â”‚
â”‚  â”‚ metadata:                                               â”‚    â”‚
â”‚  â”‚   name: guestbook-app                                   â”‚    â”‚
â”‚  â”‚ spec:                                                   â”‚    â”‚
â”‚  â”‚   replicas: 2                                           â”‚    â”‚
â”‚  â”‚   containers:                                           â”‚    â”‚
â”‚  â”‚   - name: guestbook                                     â”‚    â”‚
â”‚  â”‚     image: <ACR>.azurecr.io/guestbook:${SHA}  â† â­    â”‚    â”‚
â”‚  â”‚     ports:                                              â”‚    â”‚
â”‚  â”‚     - containerPort: 3000                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                   â”‚
â”‚  ğŸ³ ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ãƒ—ãƒ­ã‚»ã‚¹                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Worker Node 1: aks-nodepool1-xxx-vmss000000            â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  1. kubelet ãŒã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æ¤œçŸ¥                           â”‚    â”‚
â”‚  â”‚  2. ACRã«èªè¨¼ (Managed Identityä½¿ç”¨)                   â”‚    â”‚
â”‚  â”‚  3. ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’Pull (å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰)          â”‚    â”‚
â”‚  â”‚     â””â”€> docker pull <ACR>/guestbook:${SHA}            â”‚    â”‚
â”‚  â”‚  4. ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•                                      â”‚    â”‚
â”‚  â”‚     â””â”€> ã‚¤ãƒ¡ãƒ¼ã‚¸ã®å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ãƒãƒ¼ã‚¸ã—ã¦å±•é–‹           â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  ğŸ“¦ Pod: guestbook-app-xxx-6j7s4                       â”‚    â”‚
â”‚  â”‚     Container: guestbook                               â”‚    â”‚
â”‚  â”‚     â”œâ”€ /                                               â”‚    â”‚
â”‚  â”‚     â”‚  â”œâ”€ bin/                                         â”‚    â”‚
â”‚  â”‚     â”‚  â”œâ”€ usr/                                         â”‚    â”‚
â”‚  â”‚     â”‚  â””â”€ app/                â† WORKDIR               â”‚    â”‚
â”‚  â”‚     â”‚      â”œâ”€â”€ app.js                                  â”‚    â”‚
â”‚  â”‚     â”‚      â”œâ”€â”€ package.json                            â”‚    â”‚
â”‚  â”‚     â”‚      â”œâ”€â”€ wizexercise.txt  â† âœ… ã“ã“ã«å­˜åœ¨ï¼     â”‚    â”‚
â”‚  â”‚     â”‚      â”œâ”€â”€ views/                                  â”‚    â”‚
â”‚  â”‚     â”‚      â””â”€â”€ node_modules/                          â”‚    â”‚
â”‚  â”‚     â””â”€ ãƒ—ãƒ­ã‚»ã‚¹: node /app/app.js (PID 1)            â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  ğŸ” ãƒ•ã‚¡ã‚¤ãƒ«å±æ€§:                                      â”‚    â”‚
â”‚  â”‚     -rw-r--r-- 1 root root 866 Oct 30 18:22 wizexercise.txtâ”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                   â”‚
â”‚  ğŸ“Š Pod 2ã‚‚åŒã˜æ§‹æˆ:                                            â”‚
â”‚  â””â”€> guestbook-app-xxx-vdvjr (Worker Node 2)                   â”‚
â”‚      â””â”€> åŒã˜ã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‰èµ·å‹• = åŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å«ã‚€             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”‘ æ ¸å¿ƒãƒ¡ã‚«ãƒ‹ã‚ºãƒ : Dockerfile ã® COPY å‘½ä»¤

### Dockerfile ã®è©²å½“éƒ¨åˆ†

```dockerfile
FROM node:18-alpine

WORKDIR /app

# â­ wizexercise.txt ã‚’ã‚³ãƒ”ãƒ¼(ãƒ‡ãƒ¢ç”¨)
COPY wizexercise.txt /app/wizexercise.txt

# ã‚¢ãƒ—ãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ”ãƒ¼
COPY package*.json ./
RUN npm install --omit=dev

COPY . .

EXPOSE 3000

CMD ["npm", "start"]
```

### COPY å‘½ä»¤ã®å‹•ä½œè©³ç´°

```dockerfile
COPY wizexercise.txt /app/wizexercise.txt
â”‚    â”‚                â”‚
â”‚    â”‚                â””â”€ ã‚³ãƒ”ãƒ¼å…ˆ (ã‚¤ãƒ¡ãƒ¼ã‚¸å†…ã®ãƒ‘ã‚¹)
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ã‚³ãƒ”ãƒ¼å…ƒ (ãƒ“ãƒ«ãƒ‰ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå†…)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Dockerå‘½ä»¤
```

**å‡¦ç†ã®æµã‚Œ:**

1. **ãƒ“ãƒ«ãƒ‰ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæº–å‚™**

   ```bash
   # app/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒãƒ“ãƒ«ãƒ‰ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«ãªã‚‹
   docker build -t guestbook:abc123 /path/to/app/
   ```

2. **COPY å‘½ä»¤å®Ÿè¡Œ**

   - ãƒ“ãƒ«ãƒ‰ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå†…ã® `wizexercise.txt` ã‚’æ¤œç´¢
   - ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ã‚’èª­ã¿è¾¼ã¿
   - æ–°ã—ã„ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½œæˆ
   - ãƒ¬ã‚¤ãƒ¤ãƒ¼å†…ã« `/app/wizexercise.txt` ã¨ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜

3. **ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆ**

   ```
   Layer SHA256: a3f4b5c6d7e8f9...
   â”œâ”€ å¤‰æ›´ã‚¿ã‚¤ãƒ—: ADD
   â”œâ”€ ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹: /app/wizexercise.txt
   â”œâ”€ ã‚µã‚¤ã‚º: 866 bytes
   â””â”€ å†…å®¹: (ãƒ•ã‚¡ã‚¤ãƒ«ã®å®Ÿãƒ‡ãƒ¼ã‚¿)
   ```

4. **ã‚¤ãƒ¡ãƒ¼ã‚¸ã«ç„¼ãè¾¼ã¿**
   - ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã«å«ã¾ã‚Œã‚‹
   - ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒ Pull ã•ã‚Œã‚‹ã¨ã€ã“ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚‚å±•é–‹ã•ã‚Œã‚‹
   - **ãƒ•ã‚¡ã‚¤ãƒ«ã¯æ°¸ç¶šçš„ã«ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä¸€éƒ¨ã¨ãªã‚‹**

---

## ğŸ—ï¸ Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹é€ 

### ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä»•çµ„ã¿

```
Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ = è¤‡æ•°ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç©ã¿é‡ã­

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 6: Application Code           â”‚ â† COPY . .
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Layer 5: npm dependencies           â”‚ â† RUN npm install
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Layer 4: package.json               â”‚ â† COPY package*.json
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Layer 3: wizexercise.txt         â­ â”‚ â† COPY wizexercise.txt
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Layer 2: WORKDIR /app               â”‚ â† WORKDIR
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Layer 1: node:18-alpine             â”‚ â† FROM
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•æ™‚:
â†’ å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ãƒãƒ¼ã‚¸ã—ã¦å˜ä¸€ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã¨ã—ã¦è¦‹ã›ã‚‹
```

### ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç‰¹å¾´

| ç‰¹å¾´                  | èª¬æ˜                           |
| --------------------- | ------------------------------ |
| **Read-Only**         | ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯èª­ã¿å–ã‚Šå°‚ç”¨ (ä¸å¤‰)  |
| **ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¯èƒ½**    | åŒã˜ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯å†åˆ©ç”¨ã•ã‚Œã‚‹     |
| **SHA256 è­˜åˆ¥**       | å†…å®¹ãƒãƒƒã‚·ãƒ¥ã§ä¸€æ„ã«è­˜åˆ¥       |
| **å¢—åˆ†ä¿å­˜**          | å¤‰æ›´éƒ¨åˆ†ã ã‘ã‚’æ–°ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ä¿å­˜ |
| **Union File System** | è¤‡æ•°ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’é€éçš„ã«é‡ã­ã‚‹   |

---

## ğŸ”„ å®Œå…¨ãªãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«

### Phase 1: é–‹ç™º (ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ)

```bash
# ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€
D:\00_temp\wizwork\wiz-technical-exercise\app\wizexercise.txt

# å†…å®¹ç·¨é›†
notepad wizexercise.txt

# Git ã«ã‚³ãƒŸãƒƒãƒˆ
git add app/wizexercise.txt
git commit -m "Update wizexercise.txt"
git push origin main
```

**çŠ¶æ…‹:** ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ä¸Šã®é€šå¸¸ã®ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«

---

### Phase 2: ãƒ“ãƒ«ãƒ‰ (GitHub Actions)

#### 2-1. ã‚³ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ

```yaml
- name: Checkout Code
  uses: actions/checkout@v4
```

**å‹•ä½œ:**

- ãƒªãƒã‚¸ãƒˆãƒªå…¨ä½“ã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
- `app/wizexercise.txt` ã‚‚å«ã¾ã‚Œã‚‹
- GitHub Actions Runner ã® VM ã«ãƒ•ã‚¡ã‚¤ãƒ«é…ç½®

#### 2-2. Docker ãƒ“ãƒ«ãƒ‰

```yaml
- name: Build Docker Image
  run: |
    cd app
    docker build -t guestbook:${{ github.sha }} .
```

**è©³ç´°ãƒ—ãƒ­ã‚»ã‚¹:**

```bash
# å®Ÿéš›ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒãƒ³ãƒ‰
docker build -t guestbook:abc123def456 .

# Dockerãƒ‡ãƒ¼ãƒ¢ãƒ³ã®å‡¦ç†:

[Step 1/7] FROM node:18-alpine
 ---> Pulling image from Docker Hub
 ---> Using cached image (if available)
 ---> Image ID: 1a2b3c4d5e6f

[Step 2/7] WORKDIR /app
 ---> Creating directory /app
 ---> Layer ID: 7g8h9i0j1k2l

[Step 3/7] COPY wizexercise.txt /app/wizexercise.txt
 ---> Reading file: ./wizexercise.txt (866 bytes)
 ---> Creating new layer
 ---> Adding file to layer: /app/wizexercise.txt
 ---> Layer ID: 3m4n5o6p7q8r  â­ ã“ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒå«ã¾ã‚Œã‚‹

[Step 4/7] COPY package*.json ./
 ---> Layer ID: 9s0t1u2v3w4x

[Step 5/7] RUN npm install --omit=dev
 ---> Running command in temporary container
 ---> Committing changes to new layer
 ---> Layer ID: 5y6z7a8b9c0d

[Step 6/7] COPY . .
 ---> Layer ID: 1e2f3g4h5i6j

[Step 7/7] CMD ["npm", "start"]
 ---> Layer ID: 7k8l9m0n1o2p

Successfully built abc123def456
Successfully tagged guestbook:abc123def456
```

**ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿:**

```json
{
  "Id": "sha256:abc123def456...",
  "RepoTags": ["guestbook:abc123def456"],
  "Layers": [
    "sha256:1a2b3c4d5e6f...", // node:18-alpine
    "sha256:7g8h9i0j1k2l...", // WORKDIR
    "sha256:3m4n5o6p7q8r...", // wizexercise.txt â­
    "sha256:9s0t1u2v3w4x...", // package.json
    "sha256:5y6z7a8b9c0d...", // npm install
    "sha256:1e2f3g4h5i6j...", // app code
    "sha256:7k8l9m0n1o2p..." // CMD
  ]
}
```

**çŠ¶æ…‹:** Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦æ°¸ç¶šåŒ–

---

### Phase 3: ãƒ—ãƒƒã‚·ãƒ¥ (ACR)

```yaml
- name: Push to ACR
  run: |
    docker push <ACR_NAME>.azurecr.io/guestbook:${{ github.sha }}
```

**å‹•ä½œ:**

```bash
# ãƒ¬ã‚¤ãƒ¤ãƒ¼ã”ã¨ã«ãƒ—ãƒƒã‚·ãƒ¥
The push refers to repository [<ACR>.azurecr.io/guestbook]
7k8l9m0n1o2p: Preparing
1e2f3g4h5i6j: Preparing
5y6z7a8b9c0d: Preparing
9s0t1u2v3w4x: Preparing
3m4n5o6p7q8r: Preparing  â­ wizexercise.txt ãƒ¬ã‚¤ãƒ¤ãƒ¼
7g8h9i0j1k2l: Preparing
1a2b3c4d5e6f: Preparing

# ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
3m4n5o6p7q8r: Pushed  â­ 866 bytes
# ... (ä»–ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚‚ãƒ—ãƒƒã‚·ãƒ¥)

abc123def456: digest: sha256:xxx... size: 2456
```

**ACR ã§ã®ä¿å­˜:**

- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸: Azure Blob Storage
- æš—å·åŒ–: ä¿å­˜æ™‚æš—å·åŒ– (Encryption at Rest)
- ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡: Azure RBAC
- ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³: Geo-redundant storage (GRS)

**çŠ¶æ…‹:** Azure Container Registry ã«æ°¸ç¶šä¿å­˜

---

### Phase 4: ãƒ‡ãƒ—ãƒ­ã‚¤ (Kubernetes)

#### 4-1. Deployment æ›´æ–°

```yaml
- name: Update Deployment
  run: |
    kubectl set image deployment/guestbook-app \
      guestbook=<ACR>.azurecr.io/guestbook:${{ github.sha }}
```

**Kubernetes ã®å‹•ä½œ:**

```yaml
# Deployment ãŒæ›´æ–°ã•ã‚Œã‚‹
spec:
  template:
    spec:
      containers:
        - name: guestbook
          image: <ACR>.azurecr.io/guestbook:abc123def456 # æ–°ã—ã„SHA
```

#### 4-2. Pod ã®ãƒ­ãƒ¼ãƒªãƒ³ã‚°ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ

```
1. æ–°ã—ã„ReplicaSetä½œæˆ
   â””â”€> guestbook-app-abc123def456

2. Worker Node 1ã§æ–°ã—ã„Podèµ·å‹•
   â”œâ”€> kubelet ãŒã‚¤ãƒ¡ãƒ¼ã‚¸ä»•æ§˜ã‚’èª­ã¿å–ã‚‹
   â”œâ”€> ACRã‹ã‚‰èªè¨¼ (Managed Identity)
   â”œâ”€> ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’Pull
   â”‚   â””â”€> ã™ã¹ã¦ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
   â”‚       â”œâ”€ Layer 1: node:18-alpine (ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ¸ˆã¿)
   â”‚       â”œâ”€ Layer 2: WORKDIR (ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ¸ˆã¿)
   â”‚       â”œâ”€ Layer 3: wizexercise.txt (æ–°è¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰) â­
   â”‚       â”œâ”€ Layer 4: package.json
   â”‚       â”œâ”€ Layer 5: npm dependencies
   â”‚       â”œâ”€ Layer 6: app code
   â”‚       â””â”€ Layer 7: CMD
   â””â”€> ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•

3. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
   â””â”€> HTTP GET /health â†’ 200 OK

4. Service ã«è¿½åŠ 
   â””â”€> Endpoint ãƒªã‚¹ãƒˆã«è¿½åŠ 

5. å¤ã„Podã‚’å‰Šé™¤
   â””â”€> ã‚°ãƒ¬ãƒ¼ã‚¹ãƒ•ãƒ«ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³
```

#### 4-3. ã‚³ãƒ³ãƒ†ãƒŠå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ 

```bash
# Podå†…ã§ç¢ºèª
kubectl exec -it guestbook-app-xxx-6j7s4 -- sh

# ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ æ§‹é€ 
/ # ls -la /app/
total 48
drwxr-xr-x    1 root     root          4096 Oct 30 18:22 .
drwxr-xr-x    1 root     root          4096 Oct 31 03:00 ..
-rw-r--r--    1 root     root          1234 Oct 30 18:22 app.js
-rw-r--r--    1 root     root           456 Oct 30 18:22 package.json
-rw-r--r--    1 root     root           866 Oct 30 18:22 wizexercise.txt  â­
drwxr-xr-x    2 root     root          4096 Oct 30 18:22 views
drwxr-xr-x  100 root     root          4096 Oct 30 18:22 node_modules

# ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ç¢ºèª
/ # cat /app/wizexercise.txt
æ°å: yamapan
æ—¥ä»˜: 2025-10-28
CICD-AKS-Technical Exercise
...
```

**çŠ¶æ…‹:** ã‚³ãƒ³ãƒ†ãƒŠå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã¨ã—ã¦å±•é–‹æ¸ˆã¿

---

## ğŸ” æ¤œè¨¼æ–¹æ³•

### ãƒ“ãƒ«ãƒ‰æ™‚ã®ç¢ºèª

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ“ãƒ«ãƒ‰
cd app/
docker build -t test-guestbook .

# ãƒ¬ã‚¤ãƒ¤ãƒ¼å±¥æ­´ç¢ºèª
docker history test-guestbook

# å‡ºåŠ›ä¾‹:
# IMAGE          CREATED         CREATED BY                                      SIZE
# abc123def     2 minutes ago   /bin/sh -c #(nop) CMD ["npm" "start"]           0B
# 1e2f3g4h5     2 minutes ago   /bin/sh -c #(nop) COPY dir:... in /app/         2MB
# 5y6z7a8b9     3 minutes ago   /bin/sh -c npm install --omit=dev               50MB
# 9s0t1u2v3     3 minutes ago   /bin/sh -c #(nop) COPY file:... in /app/        0.5KB
# 3m4n5o6p7     3 minutes ago   /bin/sh -c #(nop) COPY file:... in /app/wiz...  866B â­
# 7g8h9i0j1     3 minutes ago   /bin/sh -c #(nop) WORKDIR /app                  0B
# 1a2b3c4d5     1 day ago       /bin/sh -c #(nop) ...                           200MB

# ã‚¤ãƒ¡ãƒ¼ã‚¸è©³ç´°ç¢ºèª
docker inspect test-guestbook

# ãƒ¬ã‚¤ãƒ¤ãƒ¼ä¸€è¦§
"Layers": [
    "sha256:1a2b3c4d5e6f...",
    "sha256:7g8h9i0j1k2l...",
    "sha256:3m4n5o6p7q8r...",  â­ wizexercise.txt
    ...
]
```

### ã‚¤ãƒ¡ãƒ¼ã‚¸å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª

```bash
# ã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ï¼ˆä¸€æ™‚çš„ï¼‰
docker run --rm test-guestbook ls -la /app/

# å‡ºåŠ›:
# -rw-r--r-- 1 root root  1234 Oct 30 18:22 app.js
# -rw-r--r-- 1 root root   866 Oct 30 18:22 wizexercise.txt â­
# -rw-r--r-- 1 root root   456 Oct 30 18:22 package.json
# drwxr-xr-x 2 root root  4096 Oct 30 18:22 views

# ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ç¢ºèª
docker run --rm test-guestbook cat /app/wizexercise.txt
```

### ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®ç¢ºèª

```bash
# Podä¸€è¦§
kubectl get pods -l app=guestbook

# å‡ºåŠ›:
# NAME                             READY   STATUS    RESTARTS   AGE
# guestbook-app-xxx-6j7s4          1/1     Running   0          5m
# guestbook-app-xxx-vdvjr          1/1     Running   0          5m

# Podå†…ã§ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª
kubectl exec -it guestbook-app-xxx-6j7s4 -- ls -la /app/wizexercise.txt

# å‡ºåŠ›:
# -rw-r--r-- 1 root root 866 Oct 30 18:22 /app/wizexercise.txt

# ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ç¢ºèª
kubectl exec -it guestbook-app-xxx-6j7s4 -- cat /app/wizexercise.txt

# ä¸¡æ–¹ã®Podã§åŒã˜å†…å®¹ã‚’ç¢ºèª
kubectl exec guestbook-app-xxx-6j7s4 -- md5sum /app/wizexercise.txt
kubectl exec guestbook-app-xxx-vdvjr -- md5sum /app/wizexercise.txt
# åŒã˜MD5ãƒãƒƒã‚·ãƒ¥ = åŒã˜ãƒ•ã‚¡ã‚¤ãƒ« âœ…
```

---

## ğŸ’¡ é‡è¦ãªæ¦‚å¿µ

### è»¢é€ vs ç„¼ãè¾¼ã¿

| æ–¹å¼         | èª¬æ˜                       | ã‚¿ã‚¤ãƒŸãƒ³ã‚°       | æ°¸ç¶šæ€§              |
| ------------ | -------------------------- | ---------------- | ------------------- |
| **è»¢é€**     | å®Ÿè¡Œæ™‚ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼   | ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•æ™‚   | ã‚³ãƒ³ãƒ†ãƒŠã«ä¾å­˜      |
| **ç„¼ãè¾¼ã¿** | ãƒ“ãƒ«ãƒ‰æ™‚ã«ã‚¤ãƒ¡ãƒ¼ã‚¸ã«å«ã‚ã‚‹ | ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰æ™‚ | ã‚¤ãƒ¡ãƒ¼ã‚¸ã«æ°¸ç¶šåŒ– âœ… |

**ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€Œç„¼ãè¾¼ã¿ã€ã‚’ä½¿ç”¨:**

- `Dockerfile` ã® `COPY` å‘½ä»¤ã§ã‚¤ãƒ¡ãƒ¼ã‚¸ã«ç„¼ãè¾¼ã¿
- ã™ã¹ã¦ã® Pod ãŒåŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒã¤
- ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒå­˜åœ¨ã™ã‚‹é™ã‚Šæ°¸ç¶šçš„

### Immutable Infrastructure (ä¸å¤‰ã‚¤ãƒ³ãƒ•ãƒ©)

```
å¾“æ¥ã®æ–¹å¼:
ã‚µãƒ¼ãƒãƒ¼èµ·å‹• â†’ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’SCPè»¢é€ â†’ è¨­å®šã‚’å¤‰æ›´
å•é¡Œ: ã‚µãƒ¼ãƒãƒ¼ã”ã¨ã«çŠ¶æ…‹ãŒç•°ãªã‚‹å¯èƒ½æ€§

Dockeræ–¹å¼ (Immutable):
ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ â†’ ã™ã¹ã¦ã‚’ç„¼ãè¾¼ã¿ â†’ ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•
åˆ©ç‚¹: ã™ã¹ã¦ã®ã‚³ãƒ³ãƒ†ãƒŠãŒåŒä¸€ã®çŠ¶æ…‹ã‹ã‚‰èµ·å‹•
```

**ãƒ¡ãƒªãƒƒãƒˆ:**

- âœ… å†ç¾æ€§: ã©ã®ç’°å¢ƒã§ã‚‚åŒã˜çµæœ
- âœ… ä¸€è²«æ€§: ã™ã¹ã¦ã® Pod ãŒåŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒã¤
- âœ… ãƒ‡ãƒãƒƒã‚°å®¹æ˜“: ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯å¤‰æ›´ã•ã‚Œãªã„
- âœ… ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ç°¡å˜: å¤ã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã«æˆ»ã™ã ã‘

---

## ğŸ¯ Wiz èª²é¡Œè¦ä»¶ã¨ã®å¯¾å¿œ

### è¦ä»¶: ã‚³ãƒ³ãƒ†ãƒŠå†…ã« wizexercise.txt (æ°åã‚’è¨˜è¼‰) ã‚’å«ã‚ã‚‹

**å®Ÿè£…æ–¹æ³•:**

1. **ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ**

   ```bash
   echo "æ°å: yamapan" > app/wizexercise.txt
   ```

2. **Dockerfile ã«è¨˜è¿°**

   ```dockerfile
   COPY wizexercise.txt /app/wizexercise.txt
   ```

3. **ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤**

   ```bash
   docker build -t guestbook .
   docker push <ACR>/guestbook
   kubectl set image ...
   ```

4. **æ¤œè¨¼**
   ```bash
   kubectl exec -it pod-name -- cat /app/wizexercise.txt
   ```

**è¦ä»¶é”æˆ: âœ…**

- ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚³ãƒ³ãƒ†ãƒŠå†…ã«å­˜åœ¨
- æ°å (yamapan) ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹
- ç¨¼åƒä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠã§å­˜åœ¨ã‚’è¨¼æ˜å¯èƒ½

### ãƒ—ãƒ¬ã‚¼ãƒ³ã§ã®èª¬æ˜ãƒã‚¤ãƒ³ãƒˆ

1. **ã©ã®ã‚ˆã†ã«æŒ¿å…¥ã—ãŸã‹**

   - Dockerfile ã® `COPY` å‘½ä»¤ã‚’ä½¿ç”¨
   - ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰æ™‚ã«ç„¼ãè¾¼ã¿

2. **å­˜åœ¨ã‚’è¨¼æ˜**

   ```bash
   # ãƒ©ã‚¤ãƒ–ãƒ‡ãƒ¢
   kubectl exec -it $(kubectl get pod -l app=guestbook -o jsonpath='{.items[0].metadata.name}') \
     -- cat /app/wizexercise.txt
   ```

3. **ãªãœã“ã®æ–¹å¼ã‹**
   - ä¸å¤‰ã‚¤ãƒ³ãƒ•ãƒ©ã®å®Ÿè·µ
   - ã™ã¹ã¦ã® Pod ã§ä¸€è²«æ€§ä¿è¨¼
   - ãƒ‡ãƒ—ãƒ­ã‚¤ã®è‡ªå‹•åŒ–

---

## ğŸ”„ æ›´æ–°ãƒ—ãƒ­ã‚»ã‚¹

### ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ã‚’å¤‰æ›´ã™ã‚‹å ´åˆ

```bash
# 1. ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†
vim app/wizexercise.txt

# 2. Git ã‚³ãƒŸãƒƒãƒˆ
git add app/wizexercise.txt
git commit -m "Update wizexercise.txt content"
git push origin main

# 3. GitHub Actions ãŒè‡ªå‹•å®Ÿè¡Œ
# - æ–°ã—ã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ (æ–°ã—ã„SHA)
# - æ–°ã—ã„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«æ›´æ–°ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’å«ã‚ã‚‹
# - ACRã«ãƒ—ãƒƒã‚·ãƒ¥
# - Kubernetes Deployment ã‚’æ›´æ–°

# 4. PodãŒãƒ­ãƒ¼ãƒªãƒ³ã‚°ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ
# - æ–°ã—ã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‰æ–°ã—ã„PodãŒèµ·å‹•
# - æ›´æ–°ã•ã‚ŒãŸwizexercise.txtã‚’å«ã‚€
```

**é‡è¦:** ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´ã™ã‚‹ã«ã¯ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å†ãƒ“ãƒ«ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚‹

---

## ğŸ“š æŠ€è¡“è©³ç´°

### Docker Build Context

```bash
docker build -t guestbook:latest .
                                 â””â”€ ãƒ“ãƒ«ãƒ‰ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ (current directory)
```

**ãƒ“ãƒ«ãƒ‰ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®å½¹å‰²:**

- `COPY` ã‚„ `ADD` å‘½ä»¤ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ç¯„å›²
- `.dockerignore` ã§é™¤å¤–ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šå¯èƒ½
- GitHub Actions ã§ã¯ `app/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ

### Union File System

```
ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ  = Union FS

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Container Layer (RW)    â”‚ â† æ›¸ãè¾¼ã¿å¯èƒ½ãƒ¬ã‚¤ãƒ¤ãƒ¼
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Layer 6: App Code (RO)  â”‚ â†‘
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ èª­ã¿å–ã‚Šå°‚ç”¨ãƒ¬ã‚¤ãƒ¤ãƒ¼
â”‚ Layer 5: Dependencies   â”‚ â”‚ (ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ¬ã‚¤ãƒ¤ãƒ¼)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ Layer 4: package.json   â”‚ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ Layer 3: wizexercise.txtâ”‚ â”‚ â­
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ Layer 2: WORKDIR        â”‚ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ Layer 1: Base Image     â”‚ â†“
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹æ™‚:
- ä¸Šä½ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰é †ã«æ¤œç´¢
- æœ€åˆã«è¦‹ã¤ã‹ã£ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨
- ã‚³ãƒ³ãƒ†ãƒŠãƒ¬ã‚¤ãƒ¤ãƒ¼ã§å¤‰æ›´å¯èƒ½ï¼ˆæ®ç™ºæ€§ï¼‰
- ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ä¸å¤‰
```

### ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚­ãƒ£ãƒƒã‚·ãƒ¥

```
åˆå›ãƒ“ãƒ«ãƒ‰:
Step 1: FROM node:18-alpine      (Pull from registry)
Step 2: WORKDIR /app             (New layer)
Step 3: COPY wizexercise.txt     (New layer) â­
Step 4: COPY package.json        (New layer)
Step 5: RUN npm install          (New layer)

2å›ç›®ã®ãƒ“ãƒ«ãƒ‰ (wizexercise.txtã‚’å¤‰æ›´):
Step 1: FROM node:18-alpine      (Using cache âœ…)
Step 2: WORKDIR /app             (Using cache âœ…)
Step 3: COPY wizexercise.txt     (Changed, new layer) â­
Step 4: COPY package.json        (Cache invalidated, rebuild)
Step 5: RUN npm install          (Cache invalidated, rebuild)

çµæœ: Step 3ä»¥é™ãŒå†å®Ÿè¡Œã•ã‚Œã‚‹
```

---

## ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### æ©Ÿå¯†æƒ…å ±ã®å–ã‚Šæ‰±ã„

âš ï¸ **wizexercise.txt ã¯ãƒ‡ãƒ¢ç”¨ãªã®ã§å•é¡Œãªã„ãŒã€ä¸€èˆ¬è«–ã¨ã—ã¦:**

```dockerfile
# âŒ æ‚ªã„ä¾‹: æ©Ÿå¯†æƒ…å ±ã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ã«ç„¼ãè¾¼ã‚€
COPY secrets.txt /app/secrets.txt  # ã‚¤ãƒ¡ãƒ¼ã‚¸ã«æ°¸ç¶šåŒ–ã•ã‚Œã‚‹ï¼

# âœ… è‰¯ã„ä¾‹: å®Ÿè¡Œæ™‚ã«æ³¨å…¥
# Kubernetes Secret ã‚’ä½¿ç”¨
```

**ç†ç”±:**

- Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯é…å¸ƒã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
- ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯å‰Šé™¤ã—ã¦ã‚‚å±¥æ­´ã«æ®‹ã‚‹
- ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ Pull ã—ãŸèª°ã§ã‚‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŠ½å‡ºå¯èƒ½

### æœ€å°æ¨©é™ã®åŸå‰‡

```dockerfile
# wizexercise.txt ã®æ¨©é™
-rw-r--r-- 1 root root 866 Oct 30 18:22 /app/wizexercise.txt
â””â”€â”¬â”€â”€â”˜ â”‚    â”‚    â”‚    â””â”€ ã‚µã‚¤ã‚º
  â”‚    â”‚    â”‚    â””â”€ ã‚°ãƒ«ãƒ¼ãƒ—
  â”‚    â”‚    â””â”€ æ‰€æœ‰è€…
  â”‚    â””â”€ ã‚°ãƒ«ãƒ¼ãƒ—: èª­ã¿å–ã‚Šã®ã¿
  â””â”€ ä»–: èª­ã¿å–ã‚Šã®ã¿
```

---

## ğŸ“Š ã¾ã¨ã‚

### ä»•çµ„ã¿ã®æœ¬è³ª

**wizexercise.txt ã®æ—…:**

```
1. ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ« (app/wizexercise.txt)
   â†“ git push
2. GitHub ãƒªãƒã‚¸ãƒˆãƒª
   â†“ GitHub Actions checkout
3. GitHub Actions Runner VM
   â†“ docker build (COPYå‘½ä»¤)
4. Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ¬ã‚¤ãƒ¤ãƒ¼ (ç„¼ãè¾¼ã¿å®Œäº†)
   â†“ docker push
5. Azure Container Registry (æ°¸ç¶šä¿å­˜)
   â†“ docker pull
6. Worker Node ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚­ãƒ£ãƒƒã‚·ãƒ¥
   â†“ container start (ãƒ¬ã‚¤ãƒ¤ãƒ¼å±•é–‹)
7. Pod ã‚³ãƒ³ãƒ†ãƒŠå†… (/app/wizexercise.txt ã¨ã—ã¦å­˜åœ¨)
```

### ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒˆ

| é …ç›®           | èª¬æ˜                                      |
| -------------- | ----------------------------------------- |
| **ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ** | `Dockerfile` ã® `COPY` å‘½ä»¤ã«ã‚ˆã‚‹ç„¼ãè¾¼ã¿ |
| **ã‚¿ã‚¤ãƒŸãƒ³ã‚°** | ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰æ™‚ (1 å›ã®ã¿)               |
| **ä¿å­˜å ´æ‰€**   | Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼å†…               |
| **æ°¸ç¶šæ€§**     | ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒå­˜åœ¨ã™ã‚‹é™ã‚Šæ°¸ç¶šçš„              |
| **ä¸€è²«æ€§**     | ã™ã¹ã¦ã® Pod ãŒåŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒã¤         |
| **æ›´æ–°æ–¹æ³•**   | ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ â†’ å†ãƒ“ãƒ«ãƒ‰ â†’ å†ãƒ‡ãƒ—ãƒ­ã‚¤      |
| **åˆ©ç‚¹**       | ä¸å¤‰ã‚¤ãƒ³ãƒ•ãƒ©ã€å†ç¾æ€§ã€ä¸€è²«æ€§              |

### Wiz èª²é¡Œè¦ä»¶é”æˆ

âœ… **è¦ä»¶:** ã‚³ãƒ³ãƒ†ãƒŠå†…ã« wizexercise.txt (æ°åã‚’è¨˜è¼‰) ã‚’å«ã‚ã‚‹  
âœ… **å®Ÿè£…:** Dockerfile COPY å‘½ä»¤ã§ã‚¤ãƒ¡ãƒ¼ã‚¸ã«ç„¼ãè¾¼ã¿  
âœ… **è¨¼æ˜:** kubectl exec ã§ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ã‚’ç¢ºèªå¯èƒ½  
âœ… **èª¬æ˜:** ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ã¨ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹é€ ã‚’æ˜ç¢ºã«èª¬æ˜å¯èƒ½

---

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [Dockerfile ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](https://docs.docker.com/engine/reference/builder/)
- [Docker ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚­ãƒ£ãƒƒã‚·ãƒ¥](https://docs.docker.com/develop/dev-best-practices/)
- [Kubernetes Deployments](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/)
- [Azure Container Registry](https://learn.microsoft.com/azure/container-registry/)

---

**ã“ã®ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã«ã‚ˆã‚Šã€Wiz æŠ€è¡“èª²é¡Œã®ã€Œã‚³ãƒ³ãƒ†ãƒŠå†…ã« wizexercise.txt ã‚’å«ã‚ã‚‹ã€ã¨ã„ã†è¦ä»¶ã‚’å®Œç’§ã«æº€ãŸã—ã¦ã„ã¾ã™ï¼**

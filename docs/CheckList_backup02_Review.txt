判定日: 2025-11-06
対象リポジトリ: CICD-AKS-technical-exercise (main)
対象チェック項目: Docs/CheckList_backup01.txt 全項目
参照ドキュメント: Docs/Wiz_Tech_Exercise_V4_(1).txt, Docs/memomail.txt

1. Webアプリ (Kubernetes)
- ✅ コンテナ化アプリ構築: `app/Dockerfile` と `.github/workflows/02-1.app-deploy.yml` で Docker build → ACR push を自動化。
- ✅ MongoDB接続/データ保存: `app/app.js` が `MONGO_URI` を利用し、`02-1.app-deploy.yml` が `mongo-secret.yaml` を生成して private IP を注入。
- ✅ 外部公開 (Ingress + LB): `app/k8s/ingress.yaml` と `ingress-nginx-controller.yaml` が LoadBalancer と HTTP ルーティングを構成。
- ✅ wizexercise.txt 挿入: `Dockerfile` で `/app/wizexercise.txt` を配置し、`/wizexercise.txt` ルートで公開。
- ✅ 管理者権限付与: `app/k8s/rbac-vulnerable.yaml` で default ServiceAccount とユーザーに `cluster-admin` を付与。
- ✅ kubectlデモ: `02-1.app-deploy.yml` による `az aks command invoke` (kubectl apply / rollout) を利用した再現手順あり。

2. DBサーバ (VM 上の MongoDB)
- ✅ OS・Mongoバージョン: `infra/modules/vm-mongodb.bicep` + `install-mongodb.sh` で Ubuntu 20.04 / MongoDB 4.4 を固定。
- ✅ 公開SSH: `Allow-SSH-Internet` NSG ルールで任意 IP から 22/TCP 解放。
- ✅ 過剰クラウド権限: `01.infra-deploy.yml` が VM Managed Identity に `Virtual Machine Contributor` / `Storage Blob Data Contributor` を付与。
- ✅ MongoDB旧バージョン: 4.4 をインストールし `/var/log/mongodb-version.log` に証跡を残す。
- ✅ 認証+ネットワーク制限: `setup-mongodb-auth.sh` で認証を有効化し、NSG 27017/TCP を AKS サブネット (10.0.1.0/24) に限定済み。
- ✅ バックアップ自動化: `setup-backup.sh` が cron + mongodump + Blob 転送を実装、VM 内 `mongodb-backup.log` で結果を記録。
- ✅ 公開閲覧設定: `storage.bicep` が Blob container `publicAccess=Blob`、`supportsHttpsTrafficOnly=false` として匿名閲覧を許容。

3. Dev(Sec)Ops セクション
- ✅ VCS 管理: アプリ/Infra/Docs を GitHub リポジトリで統合管理。
- ✅ IaC パイプライン: `01.infra-deploy.yml` が Checkov → what-if → `azure/arm-deploy` を実施。
- ✅ コンテナ自動ビルド: `02-1.app-deploy.yml` が main ブランチ push で Docker build/push。
- ✅ AKS 自動デプロイ: `02-1.app-deploy.yml` が `kubectl apply`, `rollout status` を自動実行。
- ✅ セキュリティスキャン: Checkov (infra/policy) + Trivy + CodeQL をワークフローに組込み。
- ❌ （オプション）攻撃検証: Wiz 検出などの攻撃シナリオ自動化は未実施（Docs/CheckList_Demo で手動手順のみ）。

4. Cloud Native Security
- ✅ 監査ログ有効化: `infra/main.bicep` の `subscriptionActivityDiagnostics` が Activity Log → Log Analytics を構成 (#microsoft.docs.mcp https://learn.microsoft.com/azure/azure-monitor/essentials/activity-log#send-to-log-analytics 参照)。
- ✅ 予防的コントロール: `02-2.policy-guardrails.yml` / `infra/policy-guardrails.bicep` で Azure Policy を自動デプロイ。
- ✅ 検知的コントロール: `main.bicep` が `Microsoft.Security/pricings` (Defender Standard) を有効化。
- ✅ CI/CD セキュリティ: `02-1.app-deploy.yml` の CodeQL/Trivy と `.github/dependabot.yml` による依存監視。

Next Actions (優先度順)
1. P1: Wiz スキャンなど攻撃検証シナリオを自動化し、オプション要件の実演と証跡を残す。
2. P2: バックアップワークフローで SUMMARY 出力を Step Summary + アーティファクトへ整形保存し、レビュー容易性を向上。
3. P3: Log Analytics ワークブックで監査ログ/Defender アラートの可視化ダッシュボードを準備し、面接デモで即提示できる状態にする。

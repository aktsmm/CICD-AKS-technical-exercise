# Docs_issue_point - トラブル記録管理ディレクトリ

**作成日**: 2025 年 1 月 29 日  
**最終更新**: 2025 年 1 月 29 日

---

## 📋 このディレクトリの目的

プロジェクト全体で発生したトラブル、エラー、問題点を**フェーズ別**に記録・管理します。

**トラブル記録の原則**:

1. ✅ **エラーメッセージは全文コピー**
2. ✅ **発生日時を記録**
3. ✅ **解決までの試行錯誤も含める**
4. ✅ **最終的な解決方法を明記**
5. ✅ **再発防止策も記載**

---

## 📁 ドキュメント一覧

### Phase 0: プロジェクトセットアップ

| ファイル名              | 概要                                                | ステータス  | 重要度      |
| ----------------------- | --------------------------------------------------- | ----------- | ----------- |
| `CICDデプロイ考慮点.md` | GitHub Push Protection エラー、Artifact v3 非推奨等 | ✅ 解決済み | 🔴 Critical |

### Phase 0-1: GitHub Actions CI/CD 構築

| ファイル名                                   | 概要                                                    | ステータス  | 重要度      |
| -------------------------------------------- | ------------------------------------------------------- | ----------- | ----------- |
| `Phase00-01_GitHubActions修正_2025-01-29.md` | Dockerfile 未実装、CodeQL/Artifact Actions 非推奨エラー | ✅ 解決済み | 🔴 Critical |

**主なトラブル**:

- トラブル #1: Dockerfile 未実装エラー → Node.js 18 Alpine で完全実装
- トラブル #2: CodeQL Action v2 非推奨 → v3 に更新
- トラブル #3: Artifact Actions v3 非推奨 → v4 に更新
- トラブル #4: Artifact パス不正 → `outputs/infra-outputs.txt` に修正

### Phase 1: Azure インフラストラクチャデプロイ

| ファイル名                                   | 概要                               | ステータス  | 重要度      |
| -------------------------------------------- | ---------------------------------- | ----------- | ----------- |
| `Phase01_インフラデプロイ失敗_2025-01-29.md` | Storage Account ポリシー制約エラー | ✅ 解決済み | 🔴 Critical |

**主なトラブル**:

- Azure Policy による PublicAccess 制約でデプロイ失敗
- 解決策: サブスクリプション切り替え (hinokuni-sub → Visual Studio Enterprise)

### Phase 2: アプリケーションデプロイ

| ファイル名                                       | 概要                                           | ステータス  | 重要度      |
| ------------------------------------------------ | ---------------------------------------------- | ----------- | ----------- |
| `Phase02_アプリデプロイ問題と解決_2025-10-29.md` | ACR 名不一致、イメージビルド失敗、Ingress 設定 | ✅ 解決済み | 🔴 Critical |

**主なトラブル**:

- トラブル #1: ACR 名の不一致エラー → `acrwizexercise` → `acrwizdev`
- トラブル #2: Docker イメージビルド失敗 → `package.json` に依存関係追加
- トラブル #3: Pod のクラッシュループ → モジュール欠落問題
- トラブル #4: Ingress デプロイエラー → NGINX Ingress Controller 導入
- トラブル #5: UI 更新が反映されない → 動的イメージタグ実装

### Phase 3: 開発環境設定

| ファイル名                              | 概要                                   | ステータス | 重要度    |
| --------------------------------------- | -------------------------------------- | ---------- | --------- |
| `Phase03_kubectl環境設定_2025-10-29.md` | kubectl コマンドの PATH 設定と使用方法 | ✅ 完了    | 🟡 Medium |

**主な内容**:

- kubectl の既存インストール確認（v1.34.1）
- Windows PATH 環境変数への追加（永続化）
- よく使う kubectl コマンド集
- PowerShell エイリアス・補完設定の提案

---

## 🔍 参考資料・運用ガイド

| ファイル名                        | 内容                           | 用途                                 |
| --------------------------------- | ------------------------------ | ------------------------------------ |
| `インフラデプロイ確認コマンド.md` | Azure リソース確認用コマンド集 | デプロイ検証・トラブルシューティング |

---

## 📝 トラブル記録の作成ルール

### 必須項目

各トラブル記録ファイルには以下を**必ず含める**こと:

#### 1. ヘッダー情報

```markdown
# [Phase 番号]: [トラブル概要]

**発生日時**: YYYY 年 MM 月 DD 日  
**フェーズ**: Phase X - [フェーズ名]  
**重要度**: 🔴 Critical / 🟡 Warning / 🔵 Info  
**ステータス**: ✅ 解決済み / ⏳ 対応中 / ❌ 未解決
```

#### 2. エラーメッセージ (全文)

```markdown
## 🔥 エラーメッセージ (全文)

\`\`\`
[エラーメッセージをそのままコピー&ペースト]
\`\`\`
```

#### 3. 発生箇所

- ファイル名・行番号
- GitHub Actions ワークフロー名・ジョブ名・ステップ名
- コマンド実行時の作業ディレクトリ

#### 4. 原因分析

- なぜエラーが発生したか
- 根本原因は何か
- 関連する設定・コード

#### 5. 試行錯誤の記録

```markdown
## 🛠️ 試行錯誤の記録

### 試行 1: [試みた対応]

**実行内容**: ...
**結果**: ❌ 失敗 / ⚠️ 部分的成功 / ✅ 成功
**分析**: ...

### 試行 2: [試みた対応]

...
```

#### 6. 最終的な解決方法

```markdown
## ✅ 最終的な解決方法

**対応内容**:

1. 具体的な手順 1
2. 具体的な手順 2
   ...

**変更したファイル**:

- `path/to/file.ext`

**実行したコマンド**:
\`\`\`powershell
[コマンド]
\`\`\`
```

#### 7. 再発防止策

```markdown
## 🔄 再発防止策

### 1. [防止策のカテゴリ]

**対応内容**: ...
**実施時期**: ...
**担当**: ...

### 2. [防止策のカテゴリ]

...
```

---

## 🎯 重要度の定義

| 重要度          | 説明                                       | 対応優先度 |
| --------------- | ------------------------------------------ | ---------- |
| 🔴 **Critical** | プロジェクトのブロッカー、即座に対応が必要 | 最優先     |
| 🟡 **Warning**  | 機能に影響あり、計画的な対応が必要         | 高         |
| 🔵 **Info**     | 軽微な問題、情報共有レベル                 | 中〜低     |

---

## 📊 ステータスの定義

| ステータス      | 説明                               | 次のアクション             |
| --------------- | ---------------------------------- | -------------------------- |
| ✅ **解決済み** | 問題が完全に解決され、動作確認済み | 再発防止策の実施           |
| ⏳ **対応中**   | 調査中または修正作業中             | 継続的な対応               |
| ❌ **未解決**   | 未着手または対応方法不明           | 調査開始・エスカレーション |

---

## 🔍 トラブルシューティングフロー

```
1. エラー発生
   ↓
2. エラーメッセージ全文をコピー
   ↓
3. Docs_issue_point/ に新しいMarkdownファイル作成
   - ファイル名: Phase[XX]_[概要]_YYYY-MM-DD.md
   ↓
4. 必須項目に沿って記録
   - エラーメッセージ
   - 発生日時
   - 発生箇所
   ↓
5. 調査・試行錯誤
   - 試行ごとに記録を追加
   ↓
6. 解決
   - 最終的な解決方法を明記
   - 再発防止策を記載
   ↓
7. ステータスを「✅ 解決済み」に更新
```

---

## 🔗 関連ドキュメント

- `Docs_work_history/` - 作業履歴の記録
- `Docs_Secrets/` - 機密情報管理
- `.github/copilot-instructions.md` - プロジェクト全体のガイドライン
- `docs/AZURE_SETUP_INFO.md` - Azure 環境情報 (非機密情報)

---

## 📞 トラブル対応のベストプラクティス

### ✅ すべきこと

1. **即座に記録する**

   - エラーが発生したらすぐにドキュメント作成
   - 時間が経つと詳細を忘れる

2. **スクリーンショットも保存**

   - エラー画面を `Docs_issue_point/screenshots/` に保存
   - ログファイルも添付

3. **検索しやすいファイル名**

   - `Phase[番号]_[概要]_YYYY-MM-DD.md`
   - 例: `Phase02_ACRプッシュ失敗_2025-01-30.md`

4. **タイムスタンプを記録**
   - エラー発生時刻
   - 各試行の実施時刻
   - 解決時刻

### ❌ やってはいけないこと

1. **あいまいな記録**

   - 「エラーが出た」だけでは不十分
   - エラーメッセージ全文をコピーする

2. **失敗した試行を削除**

   - 失敗も貴重な情報
   - 次回同じ道を辿らないために記録

3. **解決後の放置**
   - 再発防止策まで記載して初めて完了
   - ドキュメントを更新せずに閉じない

---

## 📈 統計情報

### Phase 0-1: GitHub Actions CI/CD 構築

| 項目               | 値          |
| ------------------ | ----------- |
| 発生したトラブル数 | 4 件        |
| Critical           | 4 件        |
| 解決済み           | 4 件        |
| 平均解決時間       | 約 2-3 時間 |

### Phase 1: Azure インフラデプロイ

| 項目               | 値                         |
| ------------------ | -------------------------- |
| 発生したトラブル数 | 1 件                       |
| Critical           | 1 件                       |
| 解決済み           | 1 件                       |
| 解決方法           | サブスクリプション切り替え |

---

## 🎓 学んだ教訓

### 1. GitHub Actions のバージョン管理

**教訓**: GitHub Actions は頻繁に非推奨化される
**対策**: Dependabot の有効化、定期的なバージョンチェック

### 2. Azure Policy の事前確認

**教訓**: サブスクリプションごとに異なるポリシーが適用される
**対策**: デプロイ前に `az policy assignment list` で確認

### 3. 機密情報の扱い

**教訓**: Git 履歴に残すと削除が困難
**対策**: `.gitignore` の徹底、事前チェック

### 4. エラーメッセージの保存

**教訓**: 後から確認できないと再発時に困る
**対策**: 全文コピー、スクリーンショット保存

---

**管理者**: aktsmm  
**次回レビュー予定**: 各フェーズ完了時

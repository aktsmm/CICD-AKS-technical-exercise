# Phase 1: ç’°å¢ƒæº–å‚™ - ä½œæ¥­å±¥æ­´

**ä½œæ¥­æ—¥**: 2025 å¹´ 1 æœˆ 29 æ—¥  
**æ‹…å½“è€…**: aktsmm  
**ãƒ•ã‚§ãƒ¼ã‚º**: Phase 1 - ç’°å¢ƒæº–å‚™ãƒ»Azure ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆ

---

## ğŸ“‹ ä½œæ¥­æ¦‚è¦

Azure ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’ "hinokuni-sub" ã‹ã‚‰ "Visual Studio Enterprise (å€‹äººæ¤œè¨¼ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³)" ã«åˆ‡ã‚Šæ›¿ãˆã€GitHub Actions ç”¨ã® Service Principal ã‚’æ–°è¦ä½œæˆã—ã¾ã—ãŸã€‚

---

## ğŸ¯ ä½œæ¥­ç›®æ¨™

- [x] Azure ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆ
- [x] æ–°ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç”¨ Service Principal ä½œæˆ
- [x] GitHub Secrets æ›´æ–°æº–å‚™
- [ ] GitHub Secrets æ›´æ–°å®Ÿæ–½ (æ¬¡ãƒ•ã‚§ãƒ¼ã‚º)
- [ ] ã‚¤ãƒ³ãƒ•ãƒ©ãƒ‡ãƒ—ãƒ­ã‚¤å†å®Ÿè¡Œ (æ¬¡ãƒ•ã‚§ãƒ¼ã‚º)

---

## ğŸ”§ å®Ÿæ–½ã—ãŸä½œæ¥­å†…å®¹

### 1. Azure ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆ

**å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰**:

```powershell
az account set --subscription "832c4080-181c-476b-9db0-b3ce9596d40a"
az account show --query "{Name:name, SubscriptionId:id, TenantId:tenantId}" -o table
```

**å®Ÿè¡Œçµæœ**:

```
Name                      SubscriptionId                        TenantId
------------------------  ------------------------------------  ------------------------------------
Visual Studio Enterprise  832c4080-181c-476b-9db0-b3ce9596d40a  04879edd-d806-4f5d-86b8-d3a171c883fa
```

**åˆ‡ã‚Šæ›¿ãˆç†ç”±**:

- æ—§ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ (hinokuni-sub) ã§ Storage Account ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«ãƒãƒªã‚·ãƒ¼åˆ¶ç´„ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ
- ã‚¨ãƒ©ãƒ¼å†…å®¹: "PublicAcces..." (PublicAccessNotPermitted ã¨æ¨å®š)
- å€‹äººæ¤œè¨¼ç”¨ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã§ã¯åˆ¶ç´„ãŒç·©ã„ãŸã‚åˆ‡ã‚Šæ›¿ãˆã‚’æ±ºå®š

---

### 2. Service Principal ä½œæˆ

**å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰**:

```powershell
az ad sp create-for-rbac `
  --name "sp-wiz-exercise-github-vspro" `
  --role Contributor `
  --scopes /subscriptions/832c4080-181c-476b-9db0-b3ce9596d40a `
  --sdk-auth
```

**å®Ÿè¡Œæ™‚åˆ»**: 2025 å¹´ 1 æœˆ 29 æ—¥ (æ­£ç¢ºãªæ™‚åˆ»ã¯ç«¯æœ«ãƒ­ã‚°å‚ç…§)

**Service Principal æƒ…å ±** (Docs_Secrets ã«è©³ç´°è¨˜è¼‰):

- Service Principal Name: `sp-wiz-exercise-github-vspro`
- Role: `Contributor`
- Scope: `/subscriptions/832c4080-181c-476b-9db0-b3ce9596d40a`
- Client ID: `a2854234-bf5d-4695-ab5a-e15efb9a1cbf`
- Tenant ID: `04879edd-d806-4f5d-86b8-d3a171c883fa`

âš ï¸ **è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**:

```
Option '--sdk-auth' has been deprecated and will be removed in a future release.
```

**å¯¾å¿œãƒ¡ãƒ¢**:

- ç¾æ™‚ç‚¹ã§ã¯ --sdk-auth ãŒ GitHub Actions ã® azure/login@v1 ã§å¿…è¦
- å°†æ¥çš„ã«ã¯ Federated Identity ã¸ã®ç§»è¡Œã‚’æ¤œè¨

---

## ğŸ“Š å¤‰æ›´å‰å¾Œã®æ¯”è¼ƒ

| é …ç›®                  | å¤‰æ›´å‰                               | å¤‰æ›´å¾Œ                               |
| --------------------- | ------------------------------------ | ------------------------------------ |
| ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³å  | hinokuni-sub                         | Visual Studio Enterprise             |
| ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ ID | 7134d7ae-2fe3-4eec-8f0b-5ffad8355907 | 832c4080-181c-476b-9db0-b3ce9596d40a |
| ãƒ†ãƒŠãƒ³ãƒˆ ID           | 04879edd-d806-4f5d-86b8-d3a171c883fa | 04879edd-d806-4f5d-86b8-d3a171c883fa |
| Service Principal     | sp-wiz-exercise-github (æ¨å®š)        | sp-wiz-exercise-github-vspro         |
| ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—      | rg-wiz-exercise2                     | rg-wiz-exercise2 (åŒã˜)              |
| ãƒªãƒ¼ã‚¸ãƒ§ãƒ³            | Japan East                           | Japan East (åŒã˜)                    |

---

## ğŸ”„ æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚ºã¸ã®å¼•ãç¶™ãäº‹é …

### Phase 2 ã§å®Ÿæ–½äºˆå®š:

1. **GitHub Secrets æ›´æ–°**

   - `AZURE_CREDENTIALS` ã®æ›´æ–°
   - `AZURE_SUBSCRIPTION_ID` ã®æ›´æ–°
   - `MONGO_ADMIN_PASSWORD` ã®ç¢ºèª

2. **ã‚¤ãƒ³ãƒ•ãƒ©ãƒ‡ãƒ—ãƒ­ã‚¤å†å®Ÿè¡Œ**

   - GitHub Actions "Deploy Infrastructure" ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ‰‹å‹•å®Ÿè¡Œ
   - å…¨ãƒªã‚½ãƒ¼ã‚¹ (Storage Account å«ã‚€) ã®ãƒ‡ãƒ—ãƒ­ã‚¤æˆåŠŸç¢ºèª

3. **ãƒ‡ãƒ—ãƒ­ã‚¤æ¤œè¨¼**
   - ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å†…ã®ãƒªã‚½ãƒ¼ã‚¹ä¸€è¦§ç¢ºèª
   - AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ¥ç¶šç¢ºèª
   - MongoDB VM æ¥ç¶šç¢ºèª

---

## ğŸ“ å‚è€ƒæƒ…å ±

### ä½¿ç”¨ã—ãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [Azure CLI - az account set](https://learn.microsoft.com/ja-jp/cli/azure/account?view=azure-cli-latest#az-account-set)
- [Azure CLI - az ad sp create-for-rbac](https://learn.microsoft.com/ja-jp/cli/azure/ad/sp?view=azure-cli-latest#az-ad-sp-create-for-rbac)
- [GitHub Actions - azure/login](https://github.com/Azure/login)

### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

- `.github/workflows/infra-deploy.yml` - ã‚¤ãƒ³ãƒ•ãƒ©ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
- `infra/main.bicep` - ãƒ¡ã‚¤ãƒ³ Bicep ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
- `Docs_Secrets/Phase01_Azure_ServicePrincipal.md` - Service Principal è©³ç´°æƒ…å ±

---

## âœ… ä½œæ¥­å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [x] Azure ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆå®Ÿæ–½
- [x] ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æƒ…å ±ç¢ºèª (az account show)
- [x] Service Principal ä½œæˆå®Ÿæ–½
- [x] Service Principal æƒ…å ±ã®è¨˜éŒ² (Docs_Secrets)
- [x] ä½œæ¥­å±¥æ­´ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ
- [ ] GitHub Secrets æ›´æ–° (Phase 2)
- [ ] ã‚¤ãƒ³ãƒ•ãƒ©ãƒ‡ãƒ—ãƒ­ã‚¤å†å®Ÿè¡Œ (Phase 2)

---

**ä½œæ¥­çµ‚äº†æ™‚åˆ»**: (è¨˜éŒ²äºˆå®š)  
**æ¬¡å›ä½œæ¥­é–‹å§‹äºˆå®š**: GitHub Secrets æ›´æ–°å¾Œã™ã
